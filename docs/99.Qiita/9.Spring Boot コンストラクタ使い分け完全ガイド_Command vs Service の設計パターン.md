# Spring Boot ã‚³ãƒ³ã‚¹ãƒˆãƒ©ã‚¯ã‚¿ä½¿ã„åˆ†ã‘å®Œå…¨ã‚¬ã‚¤ãƒ‰: Command vs Service ã®è¨­è¨ˆãƒ‘ã‚¿ãƒ¼ãƒ³

## ã¯ã˜ã‚ã«

Spring Boot é–‹ç™ºã«ãŠã„ã¦ã€ã€Œãªãœ Command ã‚¯ãƒ©ã‚¹ã«ã¯ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã‚³ãƒ³ã‚¹ãƒˆãƒ©ã‚¯ã‚¿ãŒå¿…è¦ã§ã€Service ã‚¯ãƒ©ã‚¹ã«ã¯ä¸è¦ãªã®ã‹ï¼Ÿã€ã¨ã„ã†ç–‘å•ã‚’æŒã£ãŸã“ã¨ã¯ã‚ã‚Šã¾ã›ã‚“ã‹ï¼Ÿ

ã“ã®è¨˜äº‹ã§ã¯ã€Spring Boot ã® DIï¼ˆä¾å­˜æ€§æ³¨å…¥ï¼‰ã¨ JSON ãƒ‡ã‚·ãƒªã‚¢ãƒ©ã‚¤ã‚¼ãƒ¼ã‚·ãƒ§ãƒ³ã®ä»•çµ„ã¿ã‚’ç†è§£ã—ã€é©åˆ‡ãªã‚³ãƒ³ã‚¹ãƒˆãƒ©ã‚¯ã‚¿è¨­è¨ˆãƒ‘ã‚¿ãƒ¼ãƒ³ã‚’è§£èª¬ã—ã¾ã™ã€‚

## ğŸ¯ æ ¸å¿ƒï¼šäºŒã¤ã®ç•°ãªã‚‹ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹åŒ–æ–¹å¼

### Command/DTO ã‚¯ãƒ©ã‚¹ï¼šJSON å¤‰æ›ã«ã‚ˆã‚‹ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹åŒ–

```java
// HTTPãƒªã‚¯ã‚¨ã‚¹ãƒˆ â†’ JSON â†’ Javaã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆ
@PostMapping("/register")
public ResponseEntity<?> register(@RequestBody RegisterUserCommand command) {
    // â†‘ Jacksonãƒ©ã‚¤ãƒ–ãƒ©ãƒªãŒè‡ªå‹•å¤‰æ›
}
```

### Service ã‚¯ãƒ©ã‚¹ï¼šSpring DI ã«ã‚ˆã‚‹ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹åŒ–

```java
// Springã‚³ãƒ³ãƒ†ãƒŠãŒç›´æ¥ç®¡ç†ãƒ»æ³¨å…¥
@Service
public class RegisterUserService {
    // Spring DIãŒç›´æ¥å‘¼ã³å‡ºã—
    public RegisterUserService(UserRepository userRepository) { ... }
}
```

## ğŸ“‹ å®Ÿè£…ãƒ‘ã‚¿ãƒ¼ãƒ³æ¯”è¼ƒ

### âŒ é–“é•ã£ãŸç†è§£

ã€ŒService ã‚¯ãƒ©ã‚¹ã«ã‚‚ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã‚³ãƒ³ã‚¹ãƒˆãƒ©ã‚¯ã‚¿ãŒå¿…è¦ã€

### âœ… æ­£ã—ã„ç†è§£

ã€Œç”¨é€”ã«ã‚ˆã£ã¦ã‚³ãƒ³ã‚¹ãƒˆãƒ©ã‚¯ã‚¿ã®è¦ä»¶ãŒç•°ãªã‚‹ã€

## ğŸ” è©³ç´°è§£èª¬

### 1. Command ã‚¯ãƒ©ã‚¹ã®è¨­è¨ˆãƒ‘ã‚¿ãƒ¼ãƒ³

```java
/**
 * ãƒ¦ãƒ¼ã‚¶ãƒ¼ç™»éŒ²ã‚³ãƒãƒ³ãƒ‰
 * HTTPãƒªã‚¯ã‚¨ã‚¹ãƒˆãƒœãƒ‡ã‚£ã‹ã‚‰ã®è‡ªå‹•å¤‰æ›ãŒå¿…è¦
 */
public class RegisterUserCommand {
    @NotNull
    private String email;

    @NotNull
    private String password;

    @NotNull
    private String username;

    /**
     * ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã‚³ãƒ³ã‚¹ãƒˆãƒ©ã‚¯ã‚¿ï¼ˆJacksonç”¨ï¼‰
     * JSON â†’ Javaå¤‰æ›æ™‚ã«å¿…é ˆ
     */
    public RegisterUserCommand() {}

    /**
     * å…¨é …ç›®æŒ‡å®šã‚³ãƒ³ã‚¹ãƒˆãƒ©ã‚¯ã‚¿ï¼ˆãƒ†ã‚¹ãƒˆç”¨ï¼‰
     */
    public RegisterUserCommand(String email, String password, String username) {
        this.email = email;
        this.password = password;
        this.username = username;
    }

    // getter/setterå¿…é ˆï¼ˆJacksonç”¨ï¼‰
    public String getEmail() { return email; }
    public void setEmail(String email) { this.email = email; }
    // ä»–ã®getter/setterã‚‚åŒæ§˜...
}
```

**ãªãœãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã‚³ãƒ³ã‚¹ãƒˆãƒ©ã‚¯ã‚¿ãŒå¿…è¦ï¼Ÿ**

- Jackson ãƒ©ã‚¤ãƒ–ãƒ©ãƒªãŒ JSON ã‹ã‚‰ Java ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã«å¤‰æ›ã™ã‚‹éš›ã®ä»•çµ„ã¿
- Jackson å¤‰æ›ãƒ—ãƒ­ã‚»ã‚¹ï¼š`new Command()` â†’ `setEmail()` â†’ `setPassword()` â†’ `setUsername()`
- ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã‚³ãƒ³ã‚¹ãƒˆãƒ©ã‚¯ã‚¿ + setter ã®ãƒ‘ã‚¿ãƒ¼ãƒ³ãŒæ¨™æº–

### 2. Service ã‚¯ãƒ©ã‚¹ã®è¨­è¨ˆãƒ‘ã‚¿ãƒ¼ãƒ³

```java
/**
 * ãƒ¦ãƒ¼ã‚¶ãƒ¼ç™»éŒ²ã‚µãƒ¼ãƒ“ã‚¹
 * Spring DIã«ã‚ˆã‚‹ä¾å­˜æ€§æ³¨å…¥
 */
@Service
@Transactional
public class RegisterUserService {
    private final UserRepository userRepository;

    /**
     * ã‚³ãƒ³ã‚¹ãƒˆãƒ©ã‚¯ã‚¿ãƒ™ãƒ¼ã‚¹DIï¼ˆæ¨å¥¨ãƒ‘ã‚¿ãƒ¼ãƒ³ï¼‰
     * Spring Boot 2.0ä»¥é™ã¯@Autowiredä¸è¦
     */
    public RegisterUserService(UserRepository userRepository) {
        this.userRepository = userRepository;
    }

    /**
     * ãƒ“ã‚¸ãƒã‚¹ãƒ­ã‚¸ãƒƒã‚¯å®Ÿè£…
     */
    public User register(RegisterUserCommand command) {
        // é‡è¤‡ãƒã‚§ãƒƒã‚¯ã€ãƒ‰ãƒ¡ã‚¤ãƒ³ãƒ¢ãƒ‡ãƒ«ç”Ÿæˆã€æ°¸ç¶šåŒ–
        // ...
    }
}
```

**ãªãœãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã‚³ãƒ³ã‚¹ãƒˆãƒ©ã‚¯ã‚¿ãŒä¸è¦ï¼Ÿ**

- Spring ã‚³ãƒ³ãƒ†ãƒŠãŒç›´æ¥ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹åŒ–
- å¤–éƒ¨ã‹ã‚‰ã®ãƒ‡ãƒ¼ã‚¿å¤‰æ›å‡¦ç†ã¯ç™ºç”Ÿã—ãªã„
- å¿…è¦ãªä¾å­˜é–¢ä¿‚ã¯ Spring ãŒè§£æ±ºæ¸ˆã¿
- **ä¸å¤‰ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆ**ã¨ã—ã¦è¨­è¨ˆå¯èƒ½ï¼ˆfinal ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ï¼‰

## ğŸ—ï¸ Spring Boot 2.0 ä»¥é™ã®è‡ªå‹• DI æ¡ä»¶

ä»¥ä¸‹ã®æ¡ä»¶ã‚’æº€ãŸã™ã¨ã‚³ãƒ³ã‚¹ãƒˆãƒ©ã‚¯ã‚¿ãƒ™ãƒ¼ã‚¹ DI ãŒ**è‡ªå‹•**ã§å‹•ä½œï¼š

1. âœ… Spring ã‚¢ãƒãƒ†ãƒ¼ã‚·ãƒ§ãƒ³ï¼ˆ`@Service`, `@Component`ãªã©ï¼‰ãŒä»˜ä¸
2. âœ… ã‚³ãƒ³ã‚¹ãƒˆãƒ©ã‚¯ã‚¿ãŒ**1 ã¤ã ã‘**å­˜åœ¨
3. âœ… å¼•æ•°ãŒå…¨ã¦ Spring ã® Bean ã¨ã—ã¦ç™»éŒ²æ¸ˆã¿

```java
// âŒ è¤‡æ•°ã‚³ãƒ³ã‚¹ãƒˆãƒ©ã‚¯ã‚¿å­˜åœ¨æ™‚ã¯@Autowiredå¿…è¦
@Service
public class BadExample {
    private final UserRepository userRepository;

    public BadExample() { ... }  // ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã‚³ãƒ³ã‚¹ãƒˆãƒ©ã‚¯ã‚¿

    @Autowired  // å¿…é ˆï¼
    public BadExample(UserRepository userRepository) { ... }
}
```

## ğŸ“Š ä½¿ã„åˆ†ã‘ãƒ«ãƒ¼ãƒ«ä¸€è¦§

| ã‚¯ãƒ©ã‚¹ç¨®åˆ¥          | ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã‚³ãƒ³ã‚¹ãƒˆãƒ©ã‚¯ã‚¿ | ç†ç”±               | å®Ÿè£…ãƒ‘ã‚¿ãƒ¼ãƒ³            |
| ------------------- | ------------------------ | ------------------ | ----------------------- |
| **Command/DTO**     | âœ… **å¿…é ˆ**              | JSON â†” Java å¤‰æ›   | ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ + å…¨é …ç›®     |
| **Service**         | âŒ **ä¸è¦**              | Spring DI ç®¡ç†     | ã‚³ãƒ³ã‚¹ãƒˆãƒ©ã‚¯ã‚¿ãƒ™ãƒ¼ã‚¹ DI |
| **Repository å®Ÿè£…** | âŒ **ä¸è¦**              | Spring DI ç®¡ç†     | ã‚³ãƒ³ã‚¹ãƒˆãƒ©ã‚¯ã‚¿ãƒ™ãƒ¼ã‚¹ DI |
| **JPA Entity**      | âœ… **å¿…é ˆ**              | JPA/Hibernate è¦ä»¶ | protected ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ    |
| **Value Object**    | âŒ **ä¸è¦**              | ä¸å¤‰ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆ   | å¼•æ•°å¿…é ˆã‚³ãƒ³ã‚¹ãƒˆãƒ©ã‚¯ã‚¿  |

## ğŸ”§ å®Ÿè·µçš„ãªè¨­è¨ˆæŒ‡é‡

### 1. Command ã‚¯ãƒ©ã‚¹è¨­è¨ˆæ™‚ã®ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆ

- [ ] ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã‚³ãƒ³ã‚¹ãƒˆãƒ©ã‚¯ã‚¿ã®å®Ÿè£…
- [ ] å…¨é …ç›®æŒ‡å®šã‚³ãƒ³ã‚¹ãƒˆãƒ©ã‚¯ã‚¿ã®å®Ÿè£…ï¼ˆãƒ†ã‚¹ãƒˆç”¨ï¼‰
- [ ] getter/setter ã®å®Ÿè£…ï¼ˆJackson ç”¨ï¼‰
- [ ] ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ã‚¢ãƒãƒ†ãƒ¼ã‚·ãƒ§ãƒ³ã®è¨­å®š
- [ ] ãƒ‰ãƒ¡ã‚¤ãƒ³ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆå¤‰æ›ãƒ¡ã‚½ãƒƒãƒ‰ï¼ˆ`toEmail()`ãªã©ï¼‰

### 2. Service ã‚¯ãƒ©ã‚¹è¨­è¨ˆæ™‚ã®ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆ

- [ ] final ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã«ã‚ˆã‚‹ä¸å¤‰æ€§ç¢ºä¿
- [ ] ã‚³ãƒ³ã‚¹ãƒˆãƒ©ã‚¯ã‚¿å¼•æ•°ã®æœ€å°åŒ–
- [ ] å˜ä¸€è²¬ä»»åŸå‰‡ã®éµå®ˆ
- [ ] ãƒˆãƒ©ãƒ³ã‚¶ã‚¯ã‚·ãƒ§ãƒ³å¢ƒç•Œã®æ˜ç¢ºåŒ–
- [ ] é©åˆ‡ãª Javadoc è¨˜è¼‰

## ğŸš¨ ã‚ˆãã‚ã‚‹é–“é•ã„ãƒ‘ã‚¿ãƒ¼ãƒ³

### é–“é•ã„ 1ï¼šService ã‚¯ãƒ©ã‚¹ã«ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã‚³ãƒ³ã‚¹ãƒˆãƒ©ã‚¯ã‚¿ã‚’è¿½åŠ 

```java
// âŒ ä¸è¦ãªãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã‚³ãƒ³ã‚¹ãƒˆãƒ©ã‚¯ã‚¿
@Service
public class RegisterUserService {
    private UserRepository userRepository;

    public RegisterUserService() {}  // ä¸è¦ï¼

    public RegisterUserService(UserRepository userRepository) {
        this.userRepository = userRepository;
    }
}
```

### é–“é•ã„ 2ï¼šCommand ã‚¯ãƒ©ã‚¹ã§ã‚³ãƒ³ã‚¹ãƒˆãƒ©ã‚¯ã‚¿ãƒ™ãƒ¼ã‚¹ã®ã¿

```java
// âŒ ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã‚³ãƒ³ã‚¹ãƒˆãƒ©ã‚¯ã‚¿ãªã—
public class RegisterUserCommand {
    private final String email;  // JSONå¤‰æ›ã§ããªã„ï¼

    // ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã‚³ãƒ³ã‚¹ãƒˆãƒ©ã‚¯ã‚¿ãŒãªã„
    public RegisterUserCommand(String email, String password, String username) {
        this.email = email;
        // ...
    }
}
```

## ğŸ¯ ã¾ã¨ã‚

Spring Boot ã«ãŠã‘ã‚‹ã‚³ãƒ³ã‚¹ãƒˆãƒ©ã‚¯ã‚¿è¨­è¨ˆã¯ã€**ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹åŒ–ã®æ–¹å¼**ã«ã‚ˆã£ã¦æ±ºã¾ã‚Šã¾ã™ï¼š

- **JSON å¤‰æ›ãŒå¿…è¦**ãªã‚¯ãƒ©ã‚¹ â†’ ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã‚³ãƒ³ã‚¹ãƒˆãƒ©ã‚¯ã‚¿ + setter
- **Spring DI ãŒç®¡ç†**ã™ã‚‹ã‚¯ãƒ©ã‚¹ â†’ ã‚³ãƒ³ã‚¹ãƒˆãƒ©ã‚¯ã‚¿ãƒ™ãƒ¼ã‚¹ DI

ã“ã®é•ã„ã‚’ç†è§£ã™ã‚‹ã“ã¨ã§ã€é©åˆ‡ãªè¨­è¨ˆãƒ‘ã‚¿ãƒ¼ãƒ³ã‚’é¸æŠã—ã€ä¿å®ˆæ€§ã®é«˜ã„ Spring Boot ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚’æ§‹ç¯‰ã§ãã¾ã™ã€‚

## å‚è€ƒè³‡æ–™

- [Spring Framework Reference Documentation - Constructor-based Dependency Injection](https://docs.spring.io/spring-framework/docs/current/reference/html/core.html#beans-constructor-injection)
- [Jackson Documentation - Deserialization](https://github.com/FasterXML/jackson-docs)
- [Spring Boot Reference Guide - Auto-configuration](https://docs.spring.io/spring-boot/docs/current/reference/html/features.html#features.spring-application.auto-configuration)

---

ã“ã®è¨˜äº‹ãŒ Spring Boot ã§ã®ã‚³ãƒ³ã‚¹ãƒˆãƒ©ã‚¯ã‚¿è¨­è¨ˆã®ç†è§£ã«å½¹ç«‹ã¦ã°å¹¸ã„ã§ã™ï¼
