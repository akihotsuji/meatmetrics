# åˆã‚ã¦ã® DDD å®Ÿè£…ï¼šUser é›†ç´„ãƒ«ãƒ¼ãƒˆã§å­¦ã‚“ã ã€Œå€¤ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã€ã¨ã€Œè²¬å‹™åˆ†é›¢ã€ã®å¨åŠ›

## ã¯ã˜ã‚ã«

ã€ŒDDD ã£ã¦é›£ã—ãã†...ã€ã¨æ€ã£ã¦ã„ãŸç§ãŒã€å®Ÿéš›ã« User é›†ç´„ãƒ«ãƒ¼ãƒˆã‚’å®Ÿè£…ã—ã¦ã¿ã¦æ°—ã¥ã„ãŸ**å€¤ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã®å¨åŠ›**ã¨**è²¬å‹™åˆ†é›¢ã®åŠ¹æœ**ã«ã¤ã„ã¦æ›¸ã„ã¦ã¿ã¾ã™ã€‚

æ­£ç›´ã€æœ€åˆã¯ã€Œã‚ã–ã‚ã– Email ã‚¯ãƒ©ã‚¹ä½œã‚‹å¿…è¦ã‚ã‚‹ï¼Ÿã€ã£ã¦æ€ã£ã¦ã¾ã—ãŸãŒã€å®Ÿè£…ã—ã¦ã¿ã‚‹ã¨**ãƒã‚°ãŒæ¿€æ¸›**ã—ã¦ã€Œã“ã‚Œã¯ä½¿ãˆã‚‹ï¼ã€ã¨ãªã£ãŸä½“é¨“è«‡ã§ã™ã€‚

---

## å¾“æ¥ã®å®Ÿè£…ã§æ„Ÿã˜ã¦ã„ãŸèª²é¡Œ

ã¾ãšã€DDD ã‚’å°å…¥ã™ã‚‹å‰ã®å®Ÿè£…ã§æ„Ÿã˜ã¦ã„ãŸèª²é¡Œã‹ã‚‰ã€‚

### ã“ã‚“ãªã‚³ãƒ¼ãƒ‰ã‚’æ›¸ã„ã¦ã„ã¾ã›ã‚“ã‹ï¼Ÿ

```java
// âŒ å¾“æ¥ã®å®Ÿè£…ï¼ˆã‚ˆãã‚ã‚‹ãƒ‘ã‚¿ãƒ¼ãƒ³ï¼‰
@Service
public class UserService {

    public void registerUser(String email, String username, String password) {
        // ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ãŒServiceå±¤ã«æ•£åœ¨
        if (email == null || !email.contains("@")) {
            throw new IllegalArgumentException("Invalid email");
        }

        if (username == null || username.length() < 3) {
            throw new IllegalArgumentException("Invalid username");
        }

        // ãƒ“ã‚¸ãƒã‚¹ãƒ­ã‚¸ãƒƒã‚¯ã‚‚Serviceå±¤ã«æ•£åœ¨
        if (userRepository.findByEmail(email).isPresent()) {
            throw new IllegalArgumentException("Email already exists");
        }

        // ã‚¨ãƒ³ãƒ†ã‚£ãƒ†ã‚£ãŒè²§è¡€çŠ¶æ…‹
        User user = new User();
        user.setEmail(email);
        user.setUsername(username);
        user.setPassword(password); // å¹³æ–‡ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰...ï¼Ÿ

        userRepository.save(user);
    }
}
```

**ã“ã®ã‚³ãƒ¼ãƒ‰ã®å•é¡Œç‚¹ï¼š**

- ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ãƒ­ã‚¸ãƒƒã‚¯ãŒã‚ã¡ã“ã¡ã«æ•£åœ¨
- ãƒ“ã‚¸ãƒã‚¹ãƒ«ãƒ¼ãƒ«ãŒ Service å±¤ã«æ··åœ¨
- ã‚¨ãƒ³ãƒ†ã‚£ãƒ†ã‚£ãŒãŸã ã®ãƒ‡ãƒ¼ã‚¿å…¥ã‚Œç‰©ï¼ˆè²§è¡€çŠ¶æ…‹ï¼‰
- ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã®ãƒãƒƒã‚·ãƒ¥åŒ–å¿˜ã‚Œãªã©ã®ãƒ’ãƒ¥ãƒ¼ãƒãƒ³ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã‚„ã™ã„

## DDD ã§æ§‹ç¯‰ã—ãŸ User é›†ç´„ãƒ«ãƒ¼ãƒˆã®æ§‹é€ 

ãã“ã§ã€DDD ã®è€ƒãˆæ–¹ã‚’å–ã‚Šå…¥ã‚Œã¦è¨­è¨ˆã—ç›´ã—ã¦ã¿ã¾ã—ãŸã€‚

### 1. é›†ç´„ã®å…¨ä½“åƒ

```mermaid
classDiagram
    class User {
        <<é›†ç´„ãƒ«ãƒ¼ãƒˆ>>
        +Long id
        +Email email
        +Username username
        +PasswordHash passwordHash
        +List~Goal~ goals
        +register(email, username, password) User
        +login(plainPassword) boolean
        +changePassword(oldPassword, newPassword)
        +setGoal(goalData) Goal
        +validateEmailUniqueness(exists) void
        +validateUsernameUniqueness(exists) void
    }

    class Goal {
        <<ã‚¨ãƒ³ãƒ†ã‚£ãƒ†ã‚£>>
        +Long id
        +Long userId
        +GoalData goalData
        +LocalDate effectiveDate
        +Boolean isActive
        +activate() void
        +deactivate() void
        +isValid() boolean
    }

    class Email {
        <<å€¤ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆ>>
        +String value
        +Email(String email)
        +isValid() boolean
    }

    class Username {
        <<å€¤ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆ>>
        +String value
        +Username(String username)
        +isValid() boolean
    }

    class PasswordHash {
        <<å€¤ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆ>>
        +String value
        +PasswordHash(String plainPassword)
        +matches(String plainPassword) boolean
    }

    User "1" --> "*" Goal : manages
    User --> "1" Email : has
    User --> "1" Username : has
    User --> "1" PasswordHash : has
```

### 2. ã€Œãªãœå€¤ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆãŒå¿…è¦ã ã£ãŸã®ã‹ã€

æœ€åˆã¯ã€Œ`String email`ã§ååˆ†ã˜ã‚ƒãªã„ï¼Ÿã€ã¨æ€ã£ã¦ã„ã¾ã—ãŸãŒã€å®Ÿè£…ã—ã¦ã¿ã¦**å€¤ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã®å¨åŠ›**ã‚’å®Ÿæ„Ÿã—ã¾ã—ãŸã€‚

#### Before: String å‹ã§ã®å®Ÿè£…å•é¡Œ

```java
// âŒ ã“ã‚Œã ã¨...
public void someMethod(String email, String username) {
    // å¼•æ•°ã®é †ç•ªã‚’é–“é•ãˆã‚„ã™ã„ï¼
    anotherMethod(username, email); // ãƒã‚°ï¼
}

public void anotherMethod(String email, String username) {
    // ã©ã£ã¡ãŒemailã‹ã‚ã‹ã‚‰ãªã„...
}
```

#### After: å€¤ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã§ã®è§£æ±º

```java
// âœ… å€¤ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆãªã‚‰å‹å®‰å…¨ï¼
public void someMethod(Email email, Username username) {
    // é–“é•ã£ãŸé †ç•ªã§æ¸¡ã›ãªã„
    anotherMethod(email, username); // ã‚³ãƒ³ãƒ‘ã‚¤ãƒ«ã‚¨ãƒ©ãƒ¼ã§æ°—ã¥ã‘ã‚‹
}

public void anotherMethod(Email email, Username username) {
    // å‹ã§æ„å›³ãŒæ˜ç¢º
}
```

**å€¤ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã®åŠ¹æœï¼š**

- **å‹å®‰å…¨æ€§**: å¼•æ•°ã®é †ç•ªé–“é•ã„ã‚’ã‚³ãƒ³ãƒ‘ã‚¤ãƒ«æ™‚ã«æ¤œå‡º
- **ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³é›†ç´„**: ãƒ¡ãƒ¼ãƒ«å½¢å¼ãƒã‚§ãƒƒã‚¯ãŒ 1 ç®‡æ‰€ã«é›†ã¾ã‚‹
- **ãƒ“ã‚¸ãƒã‚¹ãƒ«ãƒ¼ãƒ«æ˜ç¤º**: ã€Œã“ã®ã‚·ã‚¹ãƒ†ãƒ ã§ã® Emailã€ã®å®šç¾©ãŒæ˜ç¢º
- **ãƒ†ã‚¹ãƒˆã—ã‚„ã™ã•**: å€¤ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆå˜ä½“ã§ãƒ†ã‚¹ãƒˆå¯èƒ½

### 3. User é›†ç´„ãƒ«ãƒ¼ãƒˆã®è²¬å‹™åˆ†é›¢

å®Ÿè£…ã—ã¦ã¿ã¦æ°—ã¥ã„ãŸã®ã¯ã€**è²¬å‹™ã‚’æ˜ç¢ºã«åˆ†ã‘ã‚‹ã“ã¨ã§è¿·ã„ãŒãªããªã‚‹**ã“ã¨ã€‚

| ä½•ã‚’ã™ã‚‹ï¼Ÿ             | ã©ã“ãŒæ‹…å½“ï¼Ÿ    | å®Ÿè£…ãƒ¡ã‚½ãƒƒãƒ‰                   |
| ---------------------- | --------------- | ------------------------------ |
| **ãƒ¡ãƒ¼ãƒ«é‡è¤‡ãƒã‚§ãƒƒã‚¯** | User é›†ç´„ãƒ«ãƒ¼ãƒˆ | `validateEmailUniqueness()`    |
| **ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰èªè¨¼**     | User é›†ç´„ãƒ«ãƒ¼ãƒˆ | `login()`, `changePassword()`  |
| **ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«æ›´æ–°**   | User é›†ç´„ãƒ«ãƒ¼ãƒˆ | `updateProfile()`              |
| **ç›®æ¨™ã®è¿½åŠ ãƒ»å¤‰æ›´**   | User é›†ç´„ãƒ«ãƒ¼ãƒˆ | `setGoal()`, `getActiveGoal()` |
| **ãƒ‡ãƒ¼ã‚¿æ•´åˆæ€§ã®ç¶­æŒ** | User é›†ç´„ãƒ«ãƒ¼ãƒˆ | `validateGoals()`              |

---

## å®Ÿè£…ã—ã¦ã¿ãŸï¼šä½“é¨“è«‡ä»˜ãã‚³ãƒ¼ãƒ‰ä¾‹

### 1. å€¤ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‹ã‚‰å§‹ã‚ã‚ˆã†

ã¾ãšã¯å€¤ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‹ã‚‰å®Ÿè£…ã—ã¾ã—ãŸã€‚ã€Œã“ã‚“ãªã«ç°¡å˜ãªã®ã«åŠ¹æœçµ¶å¤§ï¼ã€ã¨æ„Ÿã˜ãŸé †ç•ªã§ç´¹ä»‹ã—ã¾ã™ã€‚

#### Email å€¤ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆï¼šæœ€åˆã«å®Ÿè£…ã—ã¦åŠ¹æœã‚’å®Ÿæ„Ÿ

```java
/**
 * å®Ÿè£…ã—ã¦ã¿ãŸæ„Ÿæƒ³ï¼š
 * - ã€Œãƒ¡ãƒ¼ãƒ«å½¢å¼ãƒã‚§ãƒƒã‚¯ã€ãŒ1ç®‡æ‰€ã«é›†ç´„ã•ã‚Œã¦ç®¡ç†ãŒæ¥½ï¼
 * - å¼•æ•°ã®é †ç•ªé–“é•ã„ãŒã‚³ãƒ³ãƒ‘ã‚¤ãƒ«ã‚¨ãƒ©ãƒ¼ã§æ°—ã¥ã‘ã‚‹ã‚ˆã†ã«ãªã£ãŸ
 * - ãƒ†ã‚¹ãƒˆã‚‚æ›¸ãã‚„ã™ã„
 */
public class Email {
    private static final String EMAIL_PATTERN =
        "^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\\.[a-zA-Z]{2,}$";

    private final String value;

    public Email(String email) {
        if (email == null || email.trim().isEmpty()) {
            throw new InvalidEmailException("Email cannot be null or empty");
        }

        String normalized = email.trim().toLowerCase();

        if (!Pattern.matches(EMAIL_PATTERN, normalized)) {
            throw new InvalidEmailException("Invalid email format");
        }

        this.value = normalized;
    }

    public String getValue() { return value; }

    // equals, hashCode ã¯çœç•¥
}
```

#### PasswordHash å€¤ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆï¼šã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã®ãƒŸã‚¹ãŒæ¿€æ¸›

```java
/**
 * å®Ÿè£…ã—ã¦ã¿ãŸæ„Ÿæƒ³ï¼š
 * - ã€Œãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã®ãƒãƒƒã‚·ãƒ¥åŒ–å¿˜ã‚Œã€ãŒå®Œå…¨ã«ãªããªã£ãŸï¼
 * - ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ç…§åˆãƒ­ã‚¸ãƒƒã‚¯ãŒé›†ç´„ã•ã‚Œã¦ã€é–“é•ã„ãŒèµ·ãã«ãã„
 * - ã‚³ãƒ³ã‚¹ãƒˆãƒ©ã‚¯ã‚¿ã§è‡ªå‹•çš„ã«ãƒãƒƒã‚·ãƒ¥åŒ–ã•ã‚Œã‚‹ã®ã§å®‰å¿ƒ
 */
public class PasswordHash {
    private final String value;

    public PasswordHash(String plainPassword) {
        if (plainPassword == null || plainPassword.length() < 8) {
            throw new WeakPasswordException("Password must be at least 8 characters");
        }

        // è‡ªå‹•çš„ã«ãƒãƒƒã‚·ãƒ¥åŒ–ï¼ˆãƒãƒƒã‚·ãƒ¥åŒ–å¿˜ã‚ŒãŒç™ºç”Ÿã—ãªã„ï¼‰
        this.value = hashPassword(plainPassword);
    }

    public boolean matches(String plainPassword) {
        return checkPassword(plainPassword, this.value);
    }

    private String hashPassword(String plainPassword) {
        // BCryptãªã©ã‚’ä½¿ç”¨ï¼ˆå®Ÿè£…ã¯çœç•¥ï¼‰
        return "hashed_" + plainPassword;
    }

    private boolean checkPassword(String plainPassword, String hashedPassword) {
        // ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ç…§åˆï¼ˆå®Ÿè£…ã¯çœç•¥ï¼‰
        return hashedPassword.equals("hashed_" + plainPassword);
    }
}
```

### 2. User é›†ç´„ãƒ«ãƒ¼ãƒˆã®å®Ÿè£…ï¼šãƒ“ã‚¸ãƒã‚¹ãƒ­ã‚¸ãƒƒã‚¯ã‚’å®ˆã‚‹

```java
/**
 * å®Ÿè£…ã—ã¦ã¿ãŸæ„Ÿæƒ³ï¼š
 * - ãƒ“ã‚¸ãƒã‚¹ãƒ­ã‚¸ãƒƒã‚¯ãŒUserå†…ã«é›†ç´„ã•ã‚Œã¦ã€Œã©ã“ã«ä½•ãŒã‚ã‚‹ã‹ã€ãŒæ˜ç¢ºã«ï¼
 * - Serviceå±¤ãŒã‚¹ãƒƒã‚­ãƒªã—ã¦ã€ãƒ†ã‚¹ãƒˆã—ã‚„ã™ããªã£ãŸ
 * - ã€Œã‚¢ã‚¯ãƒ†ã‚£ãƒ–ãªç›®æ¨™ã¯1ã¤ã ã‘ã€ã¿ãŸã„ãªãƒ«ãƒ¼ãƒ«ã‚’ç¢ºå®Ÿã«å®ˆã‚Œã‚‹
 */
public class User {
    private final Long id;
    private final Email email;
    private Username username;
    private PasswordHash passwordHash;
    private final List<Goal> goals;
    private final Instant createdAt;
    private Instant updatedAt;

    /**
     * ãƒ•ã‚¡ã‚¯ãƒˆãƒªãƒ¡ã‚½ãƒƒãƒ‰ï¼šãƒ¦ãƒ¼ã‚¶ãƒ¼ç™»éŒ²
     * ã€Œã©ã†ã‚„ã£ã¦Userã‚’ä½œã‚‹ã‹ã€ãŒæ˜ç¢º
     */
    public static User register(Email email, Username username, PasswordHash passwordHash) {
        return new User(email, username, passwordHash);
    }

    /**
     * ãƒ­ã‚°ã‚¤ãƒ³èªè¨¼
     * èªè¨¼ãƒ­ã‚¸ãƒƒã‚¯ã¯Userè‡ªèº«ãŒçŸ¥ã£ã¦ã„ã‚‹
     */
    public boolean login(String plainPassword) {
        return passwordHash.matches(plainPassword);
    }

    /**
     * æ–°ã—ã„ç›®æ¨™ã‚’è¨­å®š
     * ãƒ“ã‚¸ãƒã‚¹ãƒ«ãƒ¼ãƒ«ã€Œã‚¢ã‚¯ãƒ†ã‚£ãƒ–ãªç›®æ¨™ã¯1ã¤ã ã‘ã€ã‚’è‡ªå‹•çš„ã«å®ˆã‚‹
     */
    public Goal setGoal(GoalData goalData, LocalDate effectiveDate) {
        // ãƒ“ã‚¸ãƒã‚¹ãƒ«ãƒ¼ãƒ«ã‚’ç¢ºå®Ÿã«å®Ÿè¡Œ
        deactivateAllGoals();

        Goal newGoal = Goal.createActiveGoal(this.id, goalData, effectiveDate);
        this.goals.add(newGoal);
        this.updatedAt = Instant.now();

        return newGoal;
    }

    /**
     * ä¸å¤‰æ¡ä»¶ã®æ¤œè¨¼
     * Useré›†ç´„ãƒ«ãƒ¼ãƒˆãŒè²¬ä»»ã‚’æŒã¤
     */
    public void validateEmailUniqueness(boolean emailExists) {
        if (emailExists) {
            throw new DuplicateEmailException(email.getValue());
        }
    }

    // ãƒ“ã‚¸ãƒã‚¹ãƒ«ãƒ¼ãƒ«ã‚’å®ˆã‚‹ãŸã‚ã®privateãƒ¡ã‚½ãƒƒãƒ‰
    private void deactivateAllGoals() {
        goals.stream()
             .filter(Goal::isActive)
             .forEach(Goal::deactivate);
    }

    // getters...
}
```

### 2. Goal ã‚¨ãƒ³ãƒ†ã‚£ãƒ†ã‚£ã®å®Ÿè£…

```java
/**
 * Goalã‚¨ãƒ³ãƒ†ã‚£ãƒ†ã‚£
 * ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®ç›®æ¨™å€¤ã‚’ç®¡ç†ã™ã‚‹ã€‚
 * æ™‚ç³»åˆ—ã§ç®¡ç†ã•ã‚Œã€1ãƒ¦ãƒ¼ã‚¶ãƒ¼ã«ã¤ã1ã¤ã®ã‚¢ã‚¯ãƒ†ã‚£ãƒ–ãªç›®æ¨™ã‚’æŒã¤ã€‚
 */
public class Goal {
    private final Long id;
    private final Long userId;
    private final GoalData goalData;
    private final LocalDate effectiveDate;
    private Boolean isActive;
    private final Instant createdAt;
    private Instant updatedAt;

    /**
     * ãƒ•ã‚¡ã‚¯ãƒˆãƒªãƒ¡ã‚½ãƒƒãƒ‰ï¼šæ–°è¦ã‚¢ã‚¯ãƒ†ã‚£ãƒ–ç›®æ¨™ã‚’ä½œæˆ
     */
    public static Goal createActiveGoal(Long userId, GoalData goalData, LocalDate effectiveDate) {
        return new Goal(userId, goalData, effectiveDate, true);
    }

    /**
     * ç›®æ¨™ã‚’ã‚¢ã‚¯ãƒ†ã‚£ãƒ–ã«ã™ã‚‹
     */
    public void activate() {
        this.isActive = true;
        this.updatedAt = Instant.now();
    }

    /**
     * ç›®æ¨™ã‚’éã‚¢ã‚¯ãƒ†ã‚£ãƒ–ã«ã™ã‚‹
     */
    public void deactivate() {
        this.isActive = false;
        this.updatedAt = Instant.now();
    }

    /**
     * ç›®æ¨™å€¤ãŒå¦¥å½“æ€§ç¯„å›²å†…ã‹ãƒã‚§ãƒƒã‚¯ã™ã‚‹
     */
    public boolean isValid() {
        return goalData.isValid() && effectiveDate != null;
    }

    public boolean isActive() {
        return isActive;
    }

    // getters...
}

/**
 * ç›®æ¨™ãƒ‡ãƒ¼ã‚¿ã‚’è¡¨ã™å€¤ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆ
 */
public class GoalData {
    private final Map<String, Object> values;

    public GoalData(Map<String, Object> values) {
        this.values = new HashMap<>(values);
        validate();
    }

    public boolean isValid() {
        try {
            validate();
            return true;
        } catch (InvalidGoalValueException e) {
            return false;
        }
    }

    private void validate() {
        // å…·ä½“çš„ãªç›®æ¨™å€¤ã®ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ãƒ­ã‚¸ãƒƒã‚¯
        // ãƒ“ã‚¸ãƒã‚¹ãƒ«ãƒ¼ãƒ«ã«å¿œã˜ã¦å®Ÿè£…
    }

    // getters...
}
```

### 3. å€¤ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã®å®Ÿè£…ä¾‹

```java
/**
 * Emailå€¤ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆ
 * ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹å½¢å¼ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ä»˜ã
 */
public class Email {
    private static final String EMAIL_PATTERN =
        "^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\\.[a-zA-Z]{2,}$";

    private final String value;

    public Email(String email) {
        if (email == null || email.trim().isEmpty()) {
            throw new InvalidEmailException("Email cannot be null or empty");
        }

        String normalized = email.trim().toLowerCase();

        if (!Pattern.matches(EMAIL_PATTERN, normalized)) {
            throw new InvalidEmailException("Invalid email format");
        }

        this.value = normalized;
    }

    public String getValue() {
        return value;
    }

    @Override
    public boolean equals(Object o) {
        if (this == o) return true;
        if (o == null || getClass() != o.getClass()) return false;
        Email email = (Email) o;
        return Objects.equals(value, email.value);
    }

    @Override
    public int hashCode() {
        return Objects.hash(value);
    }
}

/**
 * Usernameå€¤ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆ
 */
public class Username {
    private final String value;

    public Username(String username) {
        if (username == null || username.trim().isEmpty()) {
            throw new InvalidUsernameException("Username cannot be null or empty");
        }

        String trimmed = username.trim();
        if (trimmed.length() < 3 || trimmed.length() > 30) {
            throw new InvalidUsernameException("Username must be between 3 and 30 characters");
        }

        this.value = trimmed;
    }

    public String getValue() {
        return value;
    }

    // equals, hashCode...
}

/**
 * PasswordHashå€¤ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆ
 */
public class PasswordHash {
    private final String value;

    public PasswordHash(String plainPassword) {
        if (plainPassword == null || plainPassword.length() < 8) {
            throw new WeakPasswordException("Password must be at least 8 characters");
        }

        // ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ãƒãƒƒã‚·ãƒ¥åŒ–ï¼ˆBCryptãªã©ï¼‰
        this.value = hashPassword(plainPassword);
    }

    public boolean matches(String plainPassword) {
        return checkPassword(plainPassword, this.value);
    }

    private String hashPassword(String plainPassword) {
        // ãƒãƒƒã‚·ãƒ¥åŒ–å®Ÿè£…
        return "hashed_" + plainPassword; // ç°¡ç•¥åŒ–
    }

    private boolean checkPassword(String plainPassword, String hashedPassword) {
        // ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ç…§åˆå®Ÿè£…
        return hashedPassword.equals("hashed_" + plainPassword); // ç°¡ç•¥åŒ–
    }

    // equals, hashCode...
}
```

---

## API ã¨ã®é€£æºã¨ DDD ã®åŠ¹æœ

### 1. ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚µãƒ¼ãƒ“ã‚¹ã§ã®ä½¿ç”¨ä¾‹

```java
@Service
@Transactional
public class UserService {
    private final UserRepository userRepository;

    /**
     * ãƒ¦ãƒ¼ã‚¶ãƒ¼ç™»éŒ²ã®ãƒ¦ãƒ¼ã‚¹ã‚±ãƒ¼ã‚¹
     */
    public UserRegistrationResponse registerUser(UserRegistrationRequest request) {
        // 1. å€¤ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã«ã‚ˆã‚‹å…¥åŠ›æ¤œè¨¼
        Email email = new Email(request.getEmail());
        Username username = new Username(request.getUsername());
        PasswordHash passwordHash = new PasswordHash(request.getPassword());

        // 2. Useré›†ç´„ã‚’ç”Ÿæˆ
        User user = User.register(email, username, passwordHash);

        // 3. ä¸€æ„æ€§åˆ¶ç´„ã®æ¤œè¨¼ï¼ˆé›†ç´„ãƒ«ãƒ¼ãƒˆãŒè²¬ä»»ã‚’æŒã¤ï¼‰
        user.validateEmailUniqueness(userRepository.existsByEmail(email.getValue()));
        user.validateUsernameUniqueness(userRepository.existsByUsername(username.getValue()));

        // 4. æ°¸ç¶šåŒ–
        User savedUser = userRepository.save(user);

        return new UserRegistrationResponse(savedUser.getId());
    }

    /**
     * ç›®æ¨™è¨­å®šã®ãƒ¦ãƒ¼ã‚¹ã‚±ãƒ¼ã‚¹
     */
    public void setUserGoal(Long userId, SetGoalRequest request) {
        // 1. Useré›†ç´„ã‚’å–å¾—
        User user = userRepository.findById(userId)
                                 .orElseThrow(() -> new UserNotFoundException(userId));

        // 2. é›†ç´„ãƒ«ãƒ¼ãƒˆã«ç›®æ¨™è¨­å®šã‚’å§”è­²ï¼ˆãƒ“ã‚¸ãƒã‚¹ãƒ­ã‚¸ãƒƒã‚¯ã¯é›†ç´„å†…ã§å®Ÿè¡Œï¼‰
        GoalData goalData = new GoalData(request.getGoalValues());
        Goal newGoal = user.setGoal(goalData, request.getEffectiveDate());

        // 3. æ°¸ç¶šåŒ–ï¼ˆé›†ç´„å…¨ä½“ã®æ•´åˆæ€§ãŒä¿è¨¼ã•ã‚Œã‚‹ï¼‰
        userRepository.save(user);
    }

    /**
     * ãƒ­ã‚°ã‚¤ãƒ³èªè¨¼ã®ãƒ¦ãƒ¼ã‚¹ã‚±ãƒ¼ã‚¹
     */
    public LoginResponse login(LoginRequest request) {
        // 1. å€¤ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã«ã‚ˆã‚‹å…¥åŠ›æ¤œè¨¼
        Email email = new Email(request.getEmail());

        // 2. Useré›†ç´„ã‚’å–å¾—
        User user = userRepository.findByEmail(email.getValue())
                                 .orElseThrow(() -> new InvalidCredentialsException());

        // 3. èªè¨¼ãƒ­ã‚¸ãƒƒã‚¯ã‚’é›†ç´„ã«å§”è­²
        if (!user.login(request.getPassword())) {
            throw new InvalidCredentialsException();
        }

        // 4. JWT ãƒˆãƒ¼ã‚¯ãƒ³ç”Ÿæˆ
        String token = generateToken(user.getId());

        return new LoginResponse(token, user.getId());
    }
}
```

### 2. REST Controller ã§ã®ä½¿ç”¨ä¾‹

```java
@RestController
@RequestMapping("/api/users")
@Validated
public class UserController {
    private final UserService userService;

    @PostMapping("/register")
    public ResponseEntity<UserRegistrationResponse> register(@Valid @RequestBody UserRegistrationRequest request) {
        UserRegistrationResponse response = userService.registerUser(request);
        return ResponseEntity.status(HttpStatus.CREATED).body(response);
    }

    @PostMapping("/{userId}/goals")
    public ResponseEntity<Void> setGoal(@PathVariable Long userId, @Valid @RequestBody SetGoalRequest request) {
        userService.setUserGoal(userId, request);
        return ResponseEntity.status(HttpStatus.CREATED).build();
    }

    @PostMapping("/login")
    public ResponseEntity<LoginResponse> login(@Valid @RequestBody LoginRequest request) {
        LoginResponse response = userService.login(request);
        return ResponseEntity.ok(response);
    }
}
```

### 3. ãƒ‡ãƒ¼ã‚¿è»¢é€ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆï¼ˆDTOï¼‰ã®ä¾‹

```java
// ãƒªã‚¯ã‚¨ã‚¹ãƒˆDTO
public class UserRegistrationRequest {
    @NotBlank(message = "Email is required")
    @Email(message = "Invalid email format")
    private String email;

    @NotBlank(message = "Username is required")
    @Size(min = 3, max = 30, message = "Username must be between 3 and 30 characters")
    private String username;

    @NotBlank(message = "Password is required")
    @Size(min = 8, message = "Password must be at least 8 characters")
    private String password;

    // getters and setters
}

public class SetGoalRequest {
    @NotNull(message = "Daily calorie goal is required")
    @Min(value = 800, message = "Calorie goal must be at least 800")
    @Max(value = 5000, message = "Calorie goal must not exceed 5000")
    private Integer dailyCalorieGoal;

    @NotNull(message = "Protein goal is required")
    @DecimalMin(value = "50.0", message = "Protein goal must be at least 50g")
    @DecimalMax(value = "500.0", message = "Protein goal must not exceed 500g")
    private BigDecimal proteinGoalG;

    @NotNull(message = "Effective date is required")
    @Future(message = "Effective date must be in the future")
    private LocalDate effectiveDate;

    // getters and setters
}

// ãƒ¬ã‚¹ãƒãƒ³ã‚¹DTO
public class UserRegistrationResponse {
    private Long userId;

    public UserRegistrationResponse(Long userId) {
        this.userId = userId;
    }

    // getter
}

public class LoginResponse {
    private String accessToken;
    private Long userId;
    private Instant expiresAt;

    // constructors, getters
}
```

---

## DDD ã‚’é©ç”¨ã—ãªã„å ´åˆã¨ã®æ¯”è¼ƒ

### 1. å¾“æ¥ã®ã‚¢ãƒ—ãƒ­ãƒ¼ãƒï¼ˆã‚¢ãƒ³ãƒãƒ‘ã‚¿ãƒ¼ãƒ³ï¼‰

```java
// âŒ ã‚¢ãƒ³ãƒãƒ‘ã‚¿ãƒ¼ãƒ³ï¼šServiceå±¤ã«ãƒ“ã‚¸ãƒã‚¹ãƒ­ã‚¸ãƒƒã‚¯ãŒæ•£åœ¨
@Service
public class UserService {

    public void setUserGoal(Long userId, SetGoalRequest request) {
        // ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ãŒServiceå±¤ã«æ•£åœ¨
        if (request.getDailyCalorieGoal() < 800 || request.getDailyCalorieGoal() > 5000) {
            throw new IllegalArgumentException("Invalid calorie goal");
        }

        // ãƒ“ã‚¸ãƒã‚¹ãƒ«ãƒ¼ãƒ«ãŒServiceå±¤ã«æ•£åœ¨
        List<UserGoal> activeGoals = userGoalRepository.findActiveByUserId(userId);
        for (UserGoal goal : activeGoals) {
            goal.setIsActive(false);  // ç›´æ¥çŠ¶æ…‹å¤‰æ›´
            userGoalRepository.save(goal);
        }

        // ã‚¨ãƒ³ãƒ†ã‚£ãƒ†ã‚£ãŒè²§è¡€ãƒ¢ãƒ‡ãƒ«
        UserGoal newGoal = new UserGoal();
        newGoal.setUserId(userId);
        newGoal.setDailyCalorieGoal(request.getDailyCalorieGoal());
        newGoal.setIsActive(true);
        userGoalRepository.save(newGoal);
    }
}
```

### 2. DDD ã‚¢ãƒ—ãƒ­ãƒ¼ãƒã®åˆ©ç‚¹

| è¦³ç‚¹                       | å¾“æ¥ã®ã‚¢ãƒ—ãƒ­ãƒ¼ãƒ | DDD ã‚¢ãƒ—ãƒ­ãƒ¼ãƒ       | åŠ¹æœ                   |
| -------------------------- | ---------------- | -------------------- | ---------------------- |
| **ãƒ“ã‚¸ãƒã‚¹ãƒ­ã‚¸ãƒƒã‚¯ã®å ´æ‰€** | Service å±¤ã«æ•£åœ¨ | é›†ç´„ãƒ«ãƒ¼ãƒˆå†…ã«é›†ç´„   | ãƒ­ã‚¸ãƒƒã‚¯ã®ä¸€å…ƒåŒ–ãƒ»ä¿è­· |
| **ä¸å¤‰æ¡ä»¶ã®ç¶­æŒ**         | æ‰‹å‹•ãƒ»å±äººçš„     | é›†ç´„ãŒè‡ªå‹•ä¿è¨¼       | ãƒã‚°ã®æ¸›å°‘             |
| **ã‚³ãƒ¼ãƒ‰ã®å¯èª­æ€§**         | æ‰‹ç¶šãçš„ãƒ»è¤‡é›‘   | å®£è¨€çš„ãƒ»æ„å›³æ˜ç¢º     | ä¿å®ˆæ€§å‘ä¸Š             |
| **ãƒ†ã‚¹ãƒˆã®å®¹æ˜“ã•**         | ä¾å­˜é–¢ä¿‚å¤šæ•°     | é›†ç´„å˜ä½“ã§ãƒ†ã‚¹ãƒˆå¯èƒ½ | ãƒ†ã‚¹ãƒˆåŠ¹ç‡å‘ä¸Š         |
| **å¤‰æ›´ã¸ã®å½±éŸ¿ç¯„å›²**       | åºƒç¯„å›²ã«å½±éŸ¿     | é›†ç´„å†…ã«é™å®š         | å®‰å…¨ãªå¤‰æ›´             |

### 3. å®Ÿéš›ã®åŠ¹æœæ¸¬å®š

```mermaid
graph LR
    subgraph "å¾“æ¥ã®ã‚¢ãƒ—ãƒ­ãƒ¼ãƒ"
        A1[Controller] --> B1[Service]
        B1 --> C1[Repository]
        B1 --> D1[Validation Logic]
        B1 --> E1[Business Logic]
        B1 --> F1[State Management]
    end

    subgraph "DDDã‚¢ãƒ—ãƒ­ãƒ¼ãƒ"
        A2[Controller] --> B2[Application Service]
        B2 --> C2[User Aggregate]
        C2 --> D2[Internal Validation]
        C2 --> E2[Business Rules]
        C2 --> F2[State Consistency]
        B2 --> G2[Repository]
    end

    style C2 fill:#e1f5fe
    style D2 fill:#e8f5e8
    style E2 fill:#e8f5e8
    style F2 fill:#e8f5e8
```

---

## ãƒ†ã‚¹ãƒˆæˆ¦ç•¥ã¨å®Ÿè£…

### 1. é›†ç´„ãƒ«ãƒ¼ãƒˆã®ãƒ¦ãƒ‹ãƒƒãƒˆãƒ†ã‚¹ãƒˆ

```java
@Test
class UserTest {

    @Test
    void shouldCreateValidUser() {
        // Given
        Email email = new Email("test@example.com");
        Username username = new Username("testuser");
        PasswordHash passwordHash = new PasswordHash("password123");

        // When
        User user = User.register(email, username, passwordHash);

        // Then
        assertThat(user.getEmail()).isEqualTo(email);
        assertThat(user.getUsername()).isEqualTo(username);
        assertThat(user.getPasswordHash()).isEqualTo(passwordHash);
    }

    @Test
    void shouldSetGoalAndDeactivateExistingActiveGoals() {
        // Given
        User user = createTestUser();
        UserGoal existingGoal = UserGoal.createActiveGoal(
            user.getId(), 2000, new BigDecimal("100"), new BigDecimal("80"), new BigDecimal("50"), LocalDate.now()
        );
        user.setGoal(2000, new BigDecimal("100"), new BigDecimal("80"), new BigDecimal("50"), LocalDate.now());

        // When
        UserGoal newGoal = user.setGoal(2200, new BigDecimal("120"), new BigDecimal("90"), new BigDecimal("30"), LocalDate.now().plusDays(1));

        // Then
        assertThat(newGoal.getIsActive()).isTrue();
        assertThat(user.getActiveGoal()).contains(newGoal);

        // æ—¢å­˜ã®ç›®æ¨™ãŒéã‚¢ã‚¯ãƒ†ã‚£ãƒ–ã«ãªã‚‹ã“ã¨ã‚’ç¢ºèª
        List<UserGoal> inactiveGoals = user.getAllGoals().stream()
                                          .filter(goal -> !goal.getIsActive())
                                          .toList();
        assertThat(inactiveGoals).hasSize(1);
    }

    @Test
    void shouldThrowExceptionWhenEmailAlreadyExists() {
        // Given
        User user = createTestUser();

        // When & Then
        assertThatThrownBy(() -> user.validateEmailUniqueness(true))
            .isInstanceOf(DuplicateEmailException.class)
            .hasMessageContaining("test@example.com");
    }

    @Test
    void shouldAuthenticateWithCorrectPassword() {
        // Given
        User user = createTestUser();

        // When
        boolean result = user.login("password123");

        // Then
        assertThat(result).isTrue();
    }

    @Test
    void shouldNotAuthenticateWithIncorrectPassword() {
        // Given
        User user = createTestUser();

        // When
        boolean result = user.login("wrongpassword");

        // Then
        assertThat(result).isFalse();
    }

    private User createTestUser() {
        return User.register(
            new Email("test@example.com"),
            new Username("testuser"),
            new PasswordHash("password123")
        );
    }
}
```

### 2. çµ±åˆãƒ†ã‚¹ãƒˆä¾‹

```java
@SpringBootTest
@TestMethodOrder(OrderAnnotation.class)
class UserIntegrationTest {

    @Autowired
    private UserService userService;

    @Test
    @Order(1)
    void shouldRegisterNewUser() {
        // Given
        UserRegistrationRequest request = new UserRegistrationRequest(
            "integration@test.com", "integrationuser", "password123"
        );

        // When
        UserRegistrationResponse response = userService.registerUser(request);

        // Then
        assertThat(response.getUserId()).isNotNull();
    }

    @Test
    @Order(2)
    void shouldLoginWithValidCredentials() {
        // Given
        LoginRequest request = new LoginRequest("integration@test.com", "password123");

        // When
        LoginResponse response = userService.login(request);

        // Then
        assertThat(response.getAccessToken()).isNotBlank();
        assertThat(response.getUserId()).isNotNull();
    }

    @Test
    @Order(3)
    void shouldSetUserGoal() {
        // Given - å…ˆã»ã©ç™»éŒ²ã—ãŸãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚’ä½¿ç”¨
        LoginRequest loginRequest = new LoginRequest("integration@test.com", "password123");
        LoginResponse loginResponse = userService.login(loginRequest);

        SetGoalRequest goalRequest = new SetGoalRequest(
            2000, new BigDecimal("150"), new BigDecimal("80"), new BigDecimal("50"), LocalDate.now().plusDays(1)
        );

        // When & Then - ä¾‹å¤–ãŒã‚¹ãƒ­ãƒ¼ã•ã‚Œãªã„ã“ã¨ã‚’ç¢ºèª
        assertDoesNotThrow(() -> userService.setUserGoal(loginResponse.getUserId(), goalRequest));
    }
}
```

---

## å®Ÿè£…ã—ã¦ã¿ã¦ã‚ã‹ã£ãŸã€ŒDDD ã®ãƒªã‚¢ãƒ«ãªåŠ¹æœã€

### 1. å®Ÿéš›ã«ä½“æ„Ÿã—ãŸåŠ¹æœ

æ­£ç›´ã«è¨€ã†ã¨ã€**æœ€åˆã¯ã€Œé¢å€’ãã•ã„ãª...ã€ã¨æ€ã£ã¦ã„ã¾ã—ãŸ**ã€‚ã§ã‚‚å®Ÿè£…ã—ã¦ã¿ã‚‹ã¨ï¼š

#### ğŸ¯ ãƒã‚°ãŒæ¿€æ¸›ã—ãŸ

**Beforeï¼ˆæ–‡å­—åˆ—ãƒ™ãƒ¼ã‚¹ï¼‰:**

```java
// ã“ã‚“ãªãƒã‚°ãŒé »ç™ºã—ã¦ã„ãŸ
userService.updateUser(username, email); // å¼•æ•°é€†ï¼
userService.savePassword(plainPassword); // ãƒãƒƒã‚·ãƒ¥åŒ–å¿˜ã‚Œï¼
```

**Afterï¼ˆå€¤ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆ + é›†ç´„ï¼‰:**

```java
// ã‚³ãƒ³ãƒ‘ã‚¤ãƒ«ã‚¨ãƒ©ãƒ¼ã§æ°—ã¥ã‘ã‚‹ & ãƒãƒƒã‚·ãƒ¥åŒ–è‡ªå‹•
userService.updateUser(email, username); // âœ… å‹ãŒé•ã†ã®ã§ã‚³ãƒ³ãƒ‘ã‚¤ãƒ«ã‚¨ãƒ©ãƒ¼
user.changePassword(oldPassword, newPasswordHash); // âœ… è‡ªå‹•ãƒãƒƒã‚·ãƒ¥åŒ–
```

#### ğŸš€ æ–°æ©Ÿèƒ½è¿½åŠ ãŒæ¥½ã«ãªã£ãŸ

- **ã©ã“ã«ä½•ã‚’æ›¸ã‘ã°ã„ã„ã‹è¿·ã‚ãªã„**ï¼šã€Œãƒ¦ãƒ¼ã‚¶ãƒ¼é–¢é€£ã®ãƒ­ã‚¸ãƒƒã‚¯ â†’ User é›†ç´„ã€
- **æ—¢å­˜æ©Ÿèƒ½ã‚’å£Šã™å¿ƒé…ãŒæ¸›ã£ãŸ**ï¼šä¸å¤‰æ¡ä»¶ãŒè‡ªå‹•çš„ã«å®ˆã‚‰ã‚Œã‚‹
- **ãƒ†ã‚¹ãƒˆãŒæ›¸ãã‚„ã™ã„**ï¼šé›†ç´„å˜ä½“ã§ãƒ†ã‚¹ãƒˆå¯èƒ½

#### ğŸ¤ ãƒãƒ¼ãƒ ã§ã®é–‹ç™ºãŒã‚¹ãƒ ãƒ¼ã‚ºã«

- **ã€Œã“ã®ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ã©ã“ã«æ›¸ãï¼Ÿã€ã§æ‚©ã¾ãªã„**
- **ãƒ¬ãƒ“ãƒ¥ãƒ¼ã§ã€Œãƒ“ã‚¸ãƒã‚¹ãƒ­ã‚¸ãƒƒã‚¯ã®å ´æ‰€ã€ã«ã¤ã„ã¦è­°è«–ã—ãªãã¦æ¸ˆã‚€**
- **æ–°ãƒ¡ãƒ³ãƒãƒ¼ã§ã‚‚ã€ŒUser é–¢é€£ã¯ User ã‚¯ãƒ©ã‚¹è¦‹ã‚Œã°åˆ†ã‹ã‚‹ã€**

### 2. ã€Œã“ã‚Œã¯ã‚„ã£ã¦ã‚ˆã‹ã£ãŸã€ã¨æ€ã†ãƒã‚¤ãƒ³ãƒˆ

#### âœ… å€¤ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‹ã‚‰å§‹ã‚ã‚‹

- **Email ã‚¯ãƒ©ã‚¹ã ã‘**ä½œã£ã¦ã¿ã‚‹ â†’ åŠ¹æœã‚’å®Ÿæ„Ÿ â†’ ä»–ã«ã‚‚é©ç”¨
- å°ã•ãå§‹ã‚ã¦åŠ¹æœã‚’ä½“æ„Ÿã™ã‚‹ã®ãŒé‡è¦

#### âœ… ãƒ“ã‚¸ãƒã‚¹ãƒ«ãƒ¼ãƒ«ã‚’é›†ç´„ã«é–‰ã˜è¾¼ã‚ã‚‹

- ã€Œã‚¢ã‚¯ãƒ†ã‚£ãƒ–ãªç›®æ¨™ã¯ 1 ã¤ã ã‘ã€ã¿ãŸã„ãªãƒ«ãƒ¼ãƒ«ã‚’ User.setGoal() ã«å°ã˜è¾¼ã‚ã‚‹
- Service å±¤ã«æ•£ã‚‰ã°ã£ã¦ã„ãŸãƒ­ã‚¸ãƒƒã‚¯ãŒæ•´ç†ã•ã‚Œã‚‹

#### âœ… ãƒ†ã‚¹ãƒˆãƒ•ã‚¡ãƒ¼ã‚¹ãƒˆã§å®Ÿè£…

- å€¤ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã¯ç‰¹ã«ãƒ†ã‚¹ãƒˆã—ã‚„ã™ã„
- é›†ç´„ã®ãƒ†ã‚¹ãƒˆã§ãƒ“ã‚¸ãƒã‚¹ãƒ«ãƒ¼ãƒ«ã‚’ç¢ºèªã§ãã‚‹

## ã“ã‚Œã‹ã‚‰ DDD ã‚’å§‹ã‚ã‚‹äººã¸ã®ã‚¢ãƒ‰ãƒã‚¤ã‚¹

### ğŸš€ ã¾ãšã¯å°ã•ãå§‹ã‚ã‚ˆã†

```java
// ã‚¹ãƒ†ãƒƒãƒ—1: æœ€åˆã¯Emailã‚¯ãƒ©ã‚¹ã ã‘ä½œã£ã¦ã¿ã‚‹
public class Email {
    private final String value;
    // ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ä»˜ãã‚³ãƒ³ã‚¹ãƒˆãƒ©ã‚¯ã‚¿ã ã‘
}

// ã‚¹ãƒ†ãƒƒãƒ—2: åŠ¹æœã‚’å®Ÿæ„Ÿã—ãŸã‚‰Usernameã‚¯ãƒ©ã‚¹ã‚‚
public class Username {
    private final String value;
    // é•·ã•ãƒã‚§ãƒƒã‚¯ä»˜ãã‚³ãƒ³ã‚¹ãƒˆãƒ©ã‚¯ã‚¿
}

// ã‚¹ãƒ†ãƒƒãƒ—3: æ…£ã‚Œã¦ããŸã‚‰Useré›†ç´„ãƒ«ãƒ¼ãƒˆã«æŒ‘æˆ¦
public class User {
    // ãƒ“ã‚¸ãƒã‚¹ãƒ­ã‚¸ãƒƒã‚¯ã‚’é›†ç´„å†…ã«
}
```

---

## ã¾ã¨ã‚ï¼šã€ŒDDD ã¯æ€ã£ãŸã‚ˆã‚Šå®Ÿç”¨çš„ã ã£ãŸã€

æœ€åˆã¯ã€Œç†è«–çš„ã§é›£ã—ãã†ã€ã¨æ€ã£ã¦ã„ãŸ DDD ã§ã™ãŒã€å®Ÿéš›ã« User é›†ç´„ãƒ«ãƒ¼ãƒˆã‚’å®Ÿè£…ã—ã¦ã¿ã‚‹ã¨ï¼š

- **å€¤ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã§ãƒã‚°ãŒæ¿€æ¸›**
- **ãƒ“ã‚¸ãƒã‚¹ãƒ­ã‚¸ãƒƒã‚¯ã®å ´æ‰€ã«è¿·ã‚ãªããªã£ãŸ**
- **ãƒ†ã‚¹ãƒˆãŒæ›¸ãã‚„ã™ããªã£ãŸ**
- **ãƒãƒ¼ãƒ é–‹ç™ºãŒã‚¹ãƒ ãƒ¼ã‚ºã«ãªã£ãŸ**

ç‰¹ã«**å€¤ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆ**ã¯å°å…¥ã‚³ã‚¹ãƒˆãŒä½ã„ã®ã«åŠ¹æœçµ¶å¤§ã§ã—ãŸã€‚ã€Œã‚ã–ã‚ã– Email ã‚¯ãƒ©ã‚¹ä½œã‚‹å¿…è¦ã‚ã‚‹ï¼Ÿã€ã¨æ€ã£ã¦ã„ãŸéå»ã®è‡ªåˆ†ã«ã€Œçµ¶å¯¾ä½œã£ãŸæ–¹ãŒã„ã„ã‚ˆï¼ã€ã¨ä¼ãˆãŸã„ã§ã™ã€‚

ã“ã‚Œã‹ã‚‰ DDD ã‚’å§‹ã‚ã‚‹æ–¹ã¯ã€ãœã²**å°ã•ã„å€¤ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‹ã‚‰**å§‹ã‚ã¦ã¿ã¦ãã ã•ã„ã€‚ãã£ã¨åŠ¹æœã‚’å®Ÿæ„Ÿã§ãã‚‹ã¯ãšã§ã™ï¼

---

## å‚è€ƒãƒªã‚½ãƒ¼ã‚¹

- [Domain-Driven Design: Tackling Complexity in the Heart of Software](https://www.amazon.co.jp/dp/0321125215)
- [å®Ÿè£…ãƒ‰ãƒ¡ã‚¤ãƒ³é§†å‹•è¨­è¨ˆ](https://www.amazon.co.jp/dp/479815121X)
- [Spring Boot å…¬å¼ã‚¬ã‚¤ãƒ‰](https://spring.io/guides)
